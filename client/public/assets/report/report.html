<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>分子诊断中心测序报告单</title>
</head>
<body>

  <div class="message no-print" id="message">
    字体文件下载中，请稍候... <span id="font-load-progress">0%</span>
  </div>
  <div contentEditable="true" class="print">
    <img class="logo" src="logo.png" alt="logo"/>
    <h1 class="center">分子诊断中心测序报告单</h1>
    <h2>受检者基本信息</h2>
    <hr/>
    <div class="info-section">
      <span class="info-item bold">姓名： </span>
      <span class="info-item bold">性别：</span>
      <span class="info-item bold">年龄：</span>
      <span class="info-item bold">病理编号：</span>
      <span class="info-item bold">ID号：</span>
      <span class="info-item bold">电话：</span>
      <span class="info-item bold">诊断：</span>
      <span class="info-item bold">申请科室：</span>
      <span class="info-item bold date">申请日期：</span>
      <span class="info-item-double bold">标本：</span>
      <span class="info-item bold date">报告日期：</span>
      <span class="info-item-double bold">检测项目：</span>
    </div>
    <hr/>

    <h2>检测结果总览</h2>
    <div class="table">
      <table id="table"> </table>
    </div>
  </div>

  <script>
    window.onload = () => {
      setDateStrings();
      loadCss('./report.css');
      loadFont();
    };

    function loadCss(filename) {
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = filename;
      var head = document.getElementsByTagName('head')[0];
      head.appendChild(link)
    }

    function setDateStrings() {
      var date = new Date();
      var dateString = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
      var els = document.getElementsByClassName('date');
      for (var i=0; i<els.length; i++) {
        els[i].innerHTML = els[i].innerHTML + dateString
      }
    }

    function loadFont() {
      var progressTextEl = document.getElementById('font-load-progress');
      var lastProgress = 0;

      var xml = new XMLHttpRequest();
      xml.addEventListener("load", loadHandler);
      xml.addEventListener('progress', progressHandler);
      xml.open("GET", "https://cdn-1302264317.cos.ap-nanjing.myqcloud.com/SimSun.ttf");
      xml.send();

      function loadHandler() {
        loadCss('./font.css');
        setTimeout(() => {
          document.getElementById('message').remove();
        }, 3000)
      }

      function progressHandler(e) {
        var progress = Math.round(e.loaded / e.total * 100);
        if (progress !== lastProgress) {
          lastProgress = progress;
          progressTextEl.innerText = `${progress}%`
        }
      }
    }
  </script>
</body>
</html>
